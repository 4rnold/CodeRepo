
# 概念介绍

## 为什么使用k8s

### 1、故障迁移

当某一个node节点关机或者挂掉后，node节点上的服务会自动转移到另一个node节点上，这个过程所有服务不中断。这是docker或普通云主机是不能做到的

### 2. 资源调度

当node节点上的cpu、内存不够用的时候，可以扩充node节点，新建的pod就会被kube-schedule调度到新扩充的node节点上。

### 3. 资源隔离

创建开发、运维、测试三个命名空间，切换上下文后，开发人员就只能看到开发命名空间的所有pod，看不到运维命名空间的pod，这样就不会造成影响，互不干扰，传统的主机或只有容器环境中，登录进去就会看到所有的服务或者容器

### 4. 因为采用容器技术，进程之间互不影响

### 5. 安全

不同角色有不同的权限，查看pod、删除pod等操作，RBAC 认证增加了k8s的安全，快速精准地部署应用程序。


## Kubernetes 的优势

- 可移动：公有云、私有云、混合云、物理机
- 可扩展：模块化、插件化、可挂载、可组合
- 自修复：自动部署、自动重启、自动复制、自动伸缩
- 负载均衡

k8s可以更快的更新新版本，打包应用，更新的时候可以做到不用中断服务，服务器故障不用停机，从开发环境到测试环境到生产环境的迁移及其方便，一个配置文件就搞定，一次生成image，到处运行

## k8s常用的安装方式

### 1. rancher

**优点：**

**平台部署方便**。管理容器的平台本身也基于容器部署。只要你有容器，非常简单就完成平台的部署。

**平台扩展方便**。通过agent机制，一句docker命令完成agent部署，快速增加你的物理机。同时也支持云主机。

**服务容器方便**。通过应用商店，可以迅速完成应用部署，而且还是想docker-compose那样各个中间件独立编排，可以随时扩容。

**自带账户权限**。相比k8s没有账号管理，rancher 自动账号权限体系。账号可以独立创建，也可以很方便地接入账号体系。对于公司使用是一大利器。

对开发极其友好。

**缺点：**

- 容器管理容器：不方便排查问题，不方便维护
- 启动集群的速度慢

### 2. Kubeadm（官方推荐使用）

**优点：**

**平台部署方便**。管理容器的平台本身也基于容器部署。只要你有容器，非常简单就完成平台的部署。

**平台扩展方便**

结构清晰

**缺点：**
- 容器管理容器：不方便排查问题，不方便维护
- 启动集群的速度慢
- 证书有效期1年

### 3. 二进制（稳定）

**优点：**

- 用服务来管理容器：组件直接运行在宿主机系统中
- 启动集群的速度快
- 证书有效期可以很长
- 可扩展性非常高
- 方便排查集群问题

**缺点：**

- 部署难度大
- 部署步骤多

# 环境

## 集群环境

| 集群角色| 系统版本 | ip 地址  | 资源 | 主机名|
| -------| ------   | ------- | ----- | ----- | 
| k8s-master | CentOS Linux release 7.8.2003 (Core) | 10.0.0.247 | 2C2G | k8s-master|
| k8s-node-1 | CentOS Linux release 7.8.2003 (Core) | 10.0.0.248 | 1C1G | k8s-node-1|
| k8s-node-2 | CentOS Linux release 7.8.2003 (Core) | 10.0.0.249 | 1C1G | k8s-node-2|

## 服务

| firewalld| SElinux | NetworkManager  | docker | k8s|
| -------| ------   | ------- | ----- | ----- | 
| off | off | off | 20.10.5 | 1.20.6|

## 网络

| node网络（宿主机网络）| pod网络（容器网络） | service 网络|
| -------| ------   | ------- | 
| 10.0.0.0/4 | 172.31.0.0/16 | 192.168.3.0/24 |
